<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Ecatalog extends CI_Controller {		var $filter='';	  public function __construct()       {            parent::__construct();			date_default_timezone_set('UTC');			session_start();			$this->load->model('c3model');			$this->load->library('security');			$this->load->library('email');			$this->load->library('modules');			$this->load->library('image_lib');			$this->load->library('smtp');			$this->load->helper('url');			$this->load->library('forms');			$this->load->library('fv');						$this->output->enable_profiler(FALSE);			$this->modules->session_handler();       }	      function index($action='',$id='')   {				   $this->modules->module_checker(43,'REVIEW');	   $data['ADD'] 	=  $this->modules->crud_checker(43,'ADD');	   $data['EDIT'] 	=  $this->modules->crud_checker(43,'EDIT');	   $data['DELETE'] =  $this->modules->crud_checker(43,'DELETE');	   $data['REVIEW'] =  $this->modules->crud_checker(43,'REVIEW');	   		//USER MANUAL		$data['USER_MANUAL'] = $this->modules->user_manual(9);	   	   $data['vfile']		= 'eCatalog.php';	   $data['title']		= 'San Miguel Brewing International';	   $data['page_title']	= 'E Catalog';	   $data['meta_description']	= 'San Miguel Brewing International';	   $data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';	   		//BREAD CRUMBS		$HTTP_PATH = HTTP_PATH;	    $data['breadCrumbs']	= "<a href='".$HTTP_PATH."itemDatabase'> Item Database </a>";		$data['breadCrumbs']	.=  "<li><img src='".HTTP_PATH."img/arrow.png' width='3' height='5'></li>";	    $data['breadCrumbs']	.= "<a href='".$HTTP_PATH."eCatalog'> <span style='text-transform:lowercase'>e</span>Catalogue CMS </a>";	   				//STATUS LISTS		$sql 			  = $this->db->query("SELECT * FROM e_catalog");		$data['eCatalog'] = $sql->result_array();			    if($this->modules->access_checker()==TRUE)		{			$this->load->view('innerPages',$data); 		}else{		$data['vfile']				= 'login.php';		$data['title']				= 'SMBi System Log-in | SMBi';		$data['page_title']			= 'SMBi System Log-in';		$data['meta_description']	= 'San Miguel Brewing International';		$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';		$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   		$this->load->view('login',$data); 		   }	}		function iTem_inquiry()	{		extract($_GET);				/*ADDED AUTHENTICATION FOR EMAIL*/		$config = Array(				    'protocol' => 'smtp',		    'smtp_host' => 'ssl://smtp.googlemail.com',		    'smtp_port' => 465,		    /*'smtp_user' => 'sanmiguelbeer.international@gmail.com',*/		    'smtp_user' => 'gian.asuncion@ph.c3-interactive.com',		    'smtp_pass' => 'G14nc4rl0',		    'smtp_timeout' => '4',		    'mailtype'  => 'html', 		    'charset'   => 'iso-8859-1'		);   		$this->email->initialize($config);		$this->email->set_newline("\r\n");		/*ADDED AUTHENTICATION FOR EMAIL*/				$sql = "SELECT * FROM admin_users WHERE id=$From_user_id";		$sql = $this->db->query($sql);		$from = $sql->row();				$sql = "SELECT * FROM ec_items WHERE id=$itemID";		$sql = $this->db->query($sql);		$item = $sql->row();				$sql = "SELECT image FROM ecitems_images WHERE id = (SELECT ID FROM ecitems_images WHERE itemID = $itemID AND defaultStatus=1) LIMIT 0,1";		$sql = $this->db->query($sql);		$item_img = $sql->row();		$item_img = isset($item_img->image) ? $item_img->image : 'blank.png';		$img_src = getcwd() ."/img/big/".$item_img;						$msg   = "Hi $To_full_name, <br/>From: ".$from->full_name ."<br/>";		$msg  .= "Email Address: ".$from->email_address ."<br/>  Please review comments for the item you that have uploaded under eCatalogue<br/>";		$msg  .= "Item Code: ".$item->itemCode ."<br/>";		$msg  .= "Item Name: ".$item->itemName ."<br/>";		$msg  .= "Short Description: ".$item->Short_Description ."<br/>";		$msg  .= "With this Message: <br>".$message ."<br/>";		$msg   .= "Attached is the image of the item for your reference. <br/>";				//SEND EMAIL		$this->email->clear();		$this->email->from('do.not.reply@smg.sanmiguel.com.ph', 'San Miguel Beer International, Item Inquiry');		$this->email->to($To_email_address); 		$this->email->subject('Item Inquiry');		$this->email->message($msg);			$this->email->attach($img_src);					$this->email->send();				echo $this->email->print_debugger();	}		function catalog($action='',$id='')	{	   $CI =& get_instance();	   $CI->load->library('rec_logs');			   $this->modules->module_checker(43,'REVIEW');	   $filter_AND = $this->modules->country2();		   $eCatalogID = $id;			   $table = 'e_catalog'; 		   $data['vfile']		= 'eCatalog.php';	   $data['title']		= 'San Miguel Brewing International';	   $data['page_title']	= 'eCatalogue';	   $data['meta_description']	= 'San Miguel Brewing International';	   $data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines, Southeast Asia';				//BREAD CRUMBS		$HTTP_PATH = HTTP_PATH;		$data['breadCrumbs']	 = "<a href='".$HTTP_PATH."itemDatabase'> Item Database </a>";		$data['breadCrumbs']	.=  "<li><img src='".HTTP_PATH."img/arrow.png' width='3' height='5'></li>";	    $data['breadCrumbs']	.= "<a href='".$HTTP_PATH."eCatalog'> <span style='text-transform:lowercase'>e</span>Catalogue CMS </a>";				//USER MANUAL		$data['USER_MANUAL'] = $this->modules->user_manual(9);				//CRUD		$data['ADD'] 	=  $this->modules->crud_checker(43,'ADD');		$data['EDIT'] 	=  $this->modules->crud_checker(43,'EDIT');		$data['DELETE'] =  $this->modules->crud_checker(43,'DELETE');		$data['REVIEW'] =  $this->modules->crud_checker(43,'REVIEW');						//CSRF		$data['csrf'] = "<input type='hidden' name='".$this->security->get_csrf_token_name()."' value='".$this->security->get_csrf_hash()."'>"; 				//PAGINATION		//TOTAL NUMBER OF ROWS		$data['active_page']=1;		$sql = $this->db->query("SELECT id FROM $table");		$sql = $sql->result_array();		$total_rec = count($sql);		$pagenum = 1;		$data['page_rows'] = 15; 		$data['last'] = ceil($total_rec/$data['page_rows']);				$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];				extract($_POST);		if($action=='add')	    {			$this->modules->module_checker(43,'ADD');			$data['vfile']		= 'eCatalogFORM.php';	    }	    elseif($action=="insert")		{			//print_r($_POST);			$this->modules->module_checker(43,'ADD');			//INSERT FIELD			$dbFields['title'] 							= $title;			$dbFields['tdate']  						= date('Y-m-d');			$dbFields['publish']  						= $publish;			$dbFields['countryID']  					= $_SESSION['countryID'];			$dbFields['dateAdded']  					= date('Y-m-d');						//IMAGE			$config['upload_path'] = FCPATH2.'/img/orig/';			$config['allowed_types'] = 'gif|jpg|png';			$this->upload->initialize($config);											if ( ! $this->upload->do_upload())			{				$error = array('error' => $this->upload->display_errors());			}				else			{				$upload_data=$this->upload->data();				copy($upload_data['full_path'],FCPATH2 .'/img/cover/'.$upload_data['file_name']);								/* SET IMAGE CONFIGURATION */				$config['image_library'] = 'gd2';				$config['source_image']	= FCPATH2 .'/img/cover/'.$upload_data['file_name'];				$config['quality']	= '100%';				$config['width']	= 210;				$config['height']	= 160;				$config['maintain_ratio']	= true;				$this->image_lib->initialize($config); 				$this->image_lib->resize();				$dbFields['cover'] = $upload_data['file_name'];			}						//MSG			$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'eCatalogue has been save.');						$config['allowed_types'] = 'pdf';			$this->upload->initialize($config);						if($this->upload->do_upload('file2'))			{				$imt2=$this->upload->data();				copy($imt2['full_path'],FCPATH2 .'/files/brand_guidelines/'.$imt2['file_name']);				$dbFields['brand_guidelines'] = $imt2['file_name'];			}else{				$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'Brand guidelines failed to upload, use .pdf file only. Please upload again.');			}
									$res = $this->c3model->c3crud("insert",$table,$dbFields,'');							//LOGS			$sql		= "select max(id) as max_id FROM $table";			$lastID 	= $this->c3model->c3crud("select",'','','',$sql);			$maxID 		= $lastID[0]['max_id'];			$CI->rec_logs->w($maxID,$title,'eCatalogue','eCatalogue','add');					}		elseif($action=="edit")		{			$this->modules->module_checker(43,'EDIT');			$data['vfile']		= 'eCatalogFORM.php';			$data['id'] = $id;		}		elseif($action=="update")		{			$this->modules->module_checker(43,'EDIT');			//INSERT FIELD			$dbFields['tdate']  						= date('Y-m-d');			$dbFields['title'] 							= $title;			$dbFields['publish']  						= $publish;			$dbFields['dateLastEdited']  				= date('Y-m-d');						//IMAGE			$config['upload_path'] = FCPATH2.'/img/orig/';			$config['allowed_types'] = 'gif|jpg|png|pdf';			$this->upload->initialize($config);											if ( ! $this->upload->do_upload())			{				$error = array('error' => $this->upload->display_errors());			}				else			{				$upload_data=$this->upload->data();				copy($upload_data['full_path'],FCPATH2 .'/img/cover/'.$upload_data['file_name']);								/* SET IMAGE CONFIGURATION */				$config['image_library'] = 'gd2';				$config['source_image']	= FCPATH2 .'/img/cover/'.$upload_data['file_name'];				$config['quality']	= '100%';				$config['maintain_ratio']	= true;				$this->image_lib->initialize($config); 				$this->image_lib->resize();				$dbFields['cover'] = $upload_data['file_name'];			}						if($this->upload->do_upload('file2'))			{				$imt2=$this->upload->data();				copy($imt2['full_path'],FCPATH2 .'/files/brand_guidelines/'.$imt2['file_name']);				$dbFields['brand_guidelines'] = $imt2['file_name'];			}						$this->c3model->c3crud("update",$table,$dbFields,$eCatalogID);			$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'E-Catalog has been updated.');						$CI->rec_logs->w($eCatalogID,$title,'eCatalogue','Catalogue','edit');		}		elseif($action=="page")		{			$this->modules->module_checker(43,'REVIEW');			$pagenum = $id;			$data['active_page'] = $id; 			$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];		}		elseif($action=="deleteOneItem")		{			$this->modules->module_checker(43,'DELETE');						$tables = array(			  array('tbl'=>'ec_items',					'fld'=>'ecID'));										if($this->modules->attr($tables,$id)==0)			{				//LOGS				$sql = "SELECT title FROM e_catalog WHERE id = $id";				$sql = $this->db->query($sql);				$sql = $sql->row();				$CI->rec_logs->w($id,$sql->title,'eCatalogue','eCatalogue','delete');								//CATALOG				$this->c3model->c3crud("no-res",'','','',"DELETE FROM e_catalog WHERE id='$id'");								$sql = $this->db->query("SELECT id as itemID FROM ec_items WHERE ecID = $id");				$row = $sql->result_array();								//CATALOG ITEMS				foreach($row as $r){					extract($r);										//LOGS					$sql = "SELECT itemName FROM ec_items WHERE id = $itemID";					$sql = $this->db->query($sql);					$sql = $sql->row();					$CI->rec_logs->w($itemID,$sql->itemName,'eCatalogue','eCatalogue Items','delete');										$this->c3model->c3crud("no-res",'','','',"DELETE FROM ec_items WHERE id='$itemID'");					$this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitemVendorsRef WHERE itemID='$itemID'");					$this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitems_images WHERE itemID='$itemID'");				}								//ITEMS REF				$this->c3model->c3crud("no-res",'','','',"DELETE FROM e_CatalogItemsRef WHERE eCatalogID='$id'");								$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'eCatalogue has been deleted.');			}else{				$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'eCatalogue cannot be delete because it has items. Clear all items first.');			}								}						//STATUS LISTS		$sql 			  = $this->db->query("SELECT * FROM e_catalog");		$data['eCatalog'] = $sql->result_array();	    	  if($this->modules->access_checker()==TRUE)	  {			$this->load->view('innerPages',$data); 	  }else{		$data['vfile']				= 'login.php';		$data['title']				= 'SMBi System Log-in | SMBi';		$data['page_title']			= 'SMBi System Log-in';		$data['meta_description']	= 'San Miguel Brewing International';		$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';		$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   		$this->load->view('login',$data); 		   }	}		function eCatalog_Items_Menu()	{	   $this->modules->module_checker(43,'REVIEW');	   $data['ADD'] 	=  $this->modules->crud_checker(43,'ADD');	   $data['EDIT'] 	=  $this->modules->crud_checker(43,'EDIT');	   $data['DELETE'] =  $this->modules->crud_checker(43,'DELETE');	   $data['REVIEW'] =  $this->modules->crud_checker(43,'REVIEW');			   //USER MANUAL		$data['USER_MANUAL'] = $this->modules->user_manual(7);	   	   $data['vfile']		= 'eCatalogue_items_menu.php';	   $data['title']		= 'San Miguel Brewing International';	   $data['page_title']	= 'E Catalog';	   $data['meta_description']	= 'San Miguel Brewing International';	   $data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';	   		//BREAD CRUMBS		$HTTP_PATH = HTTP_PATH;	    $data['breadCrumbs']	= "<a href='".$HTTP_PATH."itemDatabase'> Item Database </a>";		$data['breadCrumbs']	.=  "<li><img src='".HTTP_PATH."img/arrow.png' width='3' height='5'></li>";	    $data['breadCrumbs']	.= "<a href='".$HTTP_PATH."eCatalog/eCatalog_Items_Menu'> <span style='text-transform:lowercase'>e</span>Catalogue Items </a>";	   		//STATUS LISTS		$sql 			  = $this->db->query("SELECT * FROM e_catalog");		$data['eCatalog'] = $sql->result_array();				if($this->modules->access_checker()==TRUE)		{			$this->load->view('innerPages',$data); 		}else{			$data['vfile']				= 'login.php';			$data['title']				= 'SMBi System Log-in | SMBi';			$data['page_title']			= 'SMBi System Log-in';			$data['meta_description']	= 'San Miguel Brewing International';			$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';			$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   			$this->load->view('login',$data); 		    }	}		function generateImgCode($itemID='',$itemCode='',$file_name='')	{ $ctr = 0;	  $row = $this->db->query("SELECT COUNT(id) as ctr FROM ecitems_images WHERE itemID = $itemID");	  $row = $row->row();	  $ctr = $row->ctr++;	  $file_name = substr($file_name,-4);	  $new_filename = $itemCode."-".$ctr.$file_name;	  //CHECK IF EXIST	  $sql =  $this->db->query("SELECT COUNT(id) as ctr2 FROM ecitems_images WHERE itemID = $itemID AND image = '$new_filename'");      $sql =  $sql->row();	  if($sql->ctr2>=1) $ctr = $ctr++;	  	  $new_filename = $itemCode."-".$ctr.$file_name;	 	  $nameChecker=false;	  $present = 0;	  while($nameChecker!=true)	  {	   //DOUBLE CHECK IF EXIST	   $sql =  $this->db->query("SELECT COUNT(id) as present FROM ecitems_images WHERE itemID = $itemID AND image = '$new_filename'");	   $sql =  $sql->row();	 	   if($sql->present>=1){ 	    $ctr = $ctr+1;		$new_filename = $itemCode."-".$ctr.$file_name;		$nameChecker=false;	   }else{	    $nameChecker=true;	    return $new_filename = $itemCode."-".$ctr.$file_name;	   }	  }	}		function items($action='',$id='')	{		$this->modules->module_checker(43,'REVIEW');		$data['ADD'] 	=  $this->modules->crud_checker(43,'ADD');	    $data['EDIT'] 	=  $this->modules->crud_checker(43,'EDIT');	    $data['DELETE'] =  $this->modules->crud_checker(43,'DELETE');	    $data['REVIEW'] =  $this->modules->crud_checker(43,'REVIEW');				$data['vfile']		= 'eCatalogue_items_menu.php';	    $data['VENDORS_EDIT'] =  $this->modules->crud_checker(44,'EDIT');				//USER MANUAL		$data['USER_MANUAL'] = $this->modules->user_manual(7);				$CI =& get_instance();		$CI->load->library('rec_logs');	   		//BREAD CRUMBS			$data['breadCrumbs']	 =  "<a href='".HTTP_PATH."eCatalog/eCatalog_Items_Menu'> Item Database </a>";		$data['breadCrumbs']	.=  "<li><img src='".HTTP_PATH."img/arrow.png' width='3' height='5'></li>";		$data['breadCrumbs']	.= "<a href='".HTTP_PATH."eCatalog/eCatalog_Items_Menu'> eCatalogue Items </a>";		 		 	    if($action=='insert_success'){			$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'Item has been save.');		}elseif($action=="") 		{		    $data['vfile']		= 'ec-items.php';		}		elseif($action=='add') 		{		  $this->modules->module_checker(43,'ADD');		  extract($_POST);		  $data['vfile']			= 'ec-itemsForms.php';		  $data['vendors']			= array();		  $POSM_statusID			= isset($sID)			? $sID : NULL;		  $data['POSM_statusID']	= isset($POSM_statusID) ? $POSM_statusID : 147;		  $sql 						= $this->db->query("SELECT *, ec_vendors.id as vID FROM ec_vendors");		  $data['vendors'] 			= $sql->result_array();		  $data['selectedVendor'] 	= NULL;		  $data['vendors'] 			= $sql->result_array();		  $data['eCatalogID'] 		= $id;		}		elseif($action=='insert')		{			$this->modules->module_checker(43,'ADD');			if($_POST==NULL){				redirect(HTTP_PATH.'eCatalog/eCatalog_Items_Menu', 'location', 301);				die();			}					    extract($_POST);			isset($Long_Description) ? $dbFields['Long_Description'] 	= $Long_Description : '';			isset($brandID) 		 ? $dbFields['brandID'] 		  	= $brandID 			: '';			isset($POSMTypeID) 	 	 ? $dbFields['POSMTypeID'] 	  		= $POSMTypeID 		: '';			isset($POSMStatusID) 	 ? $dbFields['POSMStatusID'] 	  	= $POSMStatusID 	: '';			isset($OUTLETStatusID) 	 ? $dbFields['OUTLETStatusID']   	= $OUTLETStatusID 	: '';			isset($PremiumTypeID) 	 ? $dbFields['PremiumTypeID']    	= $PremiumTypeID 	: '';			isset($MaterialTypeID) 	 ? $dbFields['MaterialTypeID']   	= $MaterialTypeID 	: '';			isset($countryID) 		 ? $dbFields['countryID'] 		  	= $countryID 		: '';			isset($itemName) 	     ? $dbFields['itemName']         	= str_replace('"',"",$itemName) 		: '';			isset($Short_Description)? $dbFields['Short_Description'] 	= str_replace('"',"",$Short_Description): '';			isset($UnitPrice) 		 ? $dbFields['UnitPrice'] 		  	= $UnitPrice 		: '';			isset($USD_Price) 		 ? $dbFields['USD_Price'] 		  	= $USD_Price 		: '';			isset($MOQ) 			 ? $dbFields['MOQ'] 			  	= $MOQ 				: '';			isset($UOM) 		     ? $dbFields['UOM'] 			  	= $UOM 				: '';			$dbFields['dateAdded']    = date('Y-m-d');			$dbFields['dateReleased'] = ($publish=='y') ? date('Y-m-d') : '0000-00-00';			$dbFields['user_id'] 	  = $_SESSION['user_id'];						isset($Fields0001) 		 ? $dbFields['Fields0001'] 	  = $Fields0001 : '';			isset($Fields0001) 		 ? $dbFields['Fields0002'] 	  = $Fields0002 : '';			isset($Fields0001) 		 ? $dbFields['Fields0003'] 	  = $Fields0003 : '';			isset($Fields0001) 		 ? $dbFields['Fields0004'] 	  = $Fields0004 : '';			isset($Fields0001) 		 ? $dbFields['Fields0005'] 	  = $Fields0005 : '';			isset($estimated_production_lead_time) ? $dbFields['estimated_production_lead_time'] = $estimated_production_lead_time : '';			isset($price_validity) 	? $dbFields['price_validity'] = $price_validity : '';						isset($publish) 	 	 		? $dbFields['publish'] 		  			= $publish 				 : '';			isset($publish_other_country) 	? $dbFields['publish_other_country']  	= $publish_other_country : '';			isset($country_of_origin) 		? $dbFields['country_of_origin'] 		= $country_of_origin 	 : '';				isset($ecID) 					? $dbFields['ecID'] 					= $ecID 	 			 : '';							$res = $this->c3model->c3crud("insert",'ec_items',$dbFields,'');						//GET MAX ID			$sql		= "select max(id) as max_id FROM ec_items";			$lastID 	= $this->c3model->c3crud("select",'','','',$sql);			$maxID 	= $lastID[0]['max_id'];						//UPDATE ITEM CODE			$itemField['itemCode'] = $this->generate_ItemCode($maxID,$_SESSION['countryID'],isset($POSMTypeID) ? $POSMTypeID : 0);			$this->c3model->c3crud("update","ec_items",$itemField,$maxID);						//IMAGE			$config['upload_path'] = FCPATH2.'/img/items/';			$config['allowed_types'] = 'gif|jpg|png';			$this->upload->initialize($config);						if($this->upload->do_multi_upload("files")){				$files = $this->upload->get_multi_upload_data();								foreach($files as $f)				{					extract($f);					//GENERATE IMAGE CODE					$new_file_name=$this->generateImgCode($maxID,$itemField['itemCode'],$f['file_name']);					$this->imageResize($file_name,$new_file_name,$f['file_path']);					$refdbFields['itemID'] = $maxID; 					$refdbFields['image']  = $new_file_name; 										$res = $this->c3model->c3crud("insert",'ecitems_images',$refdbFields,'');				}								//TAG LAST IMAGE				$query = $this->db->query("SELECT MAX(ecitems_images.id) as lastImageID FROM ecitems_images WHERE itemID = $maxID LIMIT 1");				$row = $query->row();				$this->db->query("UPDATE  `ecitems_images` SET  `defaultStatus` =  '1' WHERE  `ecitems_images`.`id` = ". $row->lastImageID );			}						//echo $this->upload->display_errors();									//VENDOR REFERENCE			if(isset($multipleVendors))			{				$sql		= "select max(id) as max_id FROM items";				$lastID 	= $this->c3model->c3crud("select",'','','',$sql);				$menu_id 	= $lastID[0]['max_id'];								$refFields['itemID'] =  $menu_id;								foreach($multipleVendors as $mV => $value)				{					$refFields['vendorID'] = $value;					$res = $this->c3model->c3crud("insert",'ecitemVendorsRef',$refFields,'');				}			}						//INSERT IMAGES			if(isset($images))			{				foreach($images as $img => $value)				{					$refdbFields['itemID'] = $maxID; 					$refdbFields['image']  = $value; 										$res = $this->c3model->c3crud("insert",'ecitems_images',$refdbFields,'');				}							}	 			//MSG			$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'Item has been save.');			//LOGS			$CI->rec_logs->w($maxID,$itemName,'eCatalogue','eCatalogue Items','add',$itemField['itemCode']);						redirect(HTTP_PATH.'eCatalog/items/insert_success', 'refresh');		}		elseif($action=='edit')		{			$data['id'] 			= $id;			$data['vfile']			= 'ec-itemsForms.php';			$data['POSM_statusID']	= isset($sID) ? $sID : NULL;			$sql 					= $this->db->query("SELECT *, ec_vendors.id as vID FROM ec_vendors");			$data['vendors'] 		= $sql->result_array();			$data['selectedVendor'] = NULL;			$sql 			 		= $this->db->query("SELECT * FROM ecitems_images WHERE itemID = $id ORDER by defaultStatus DESC");			$data['items_images'] 	= $sql->result_array();		}		elseif($action=='update')		{			if($_POST==NULL){				redirect(HTTP_PATH.'eCatalog/eCatalog_Items_Menu', 'location', 301);				die();			}		  	extract($_POST);			isset($Long_Description) ? $dbFields['Long_Description'] 	= $Long_Description : '';			isset($brandID) 		 ? $dbFields['brandID'] 		  	= $brandID 			: '';			isset($POSMTypeID) 	 	 ? $dbFields['POSMTypeID'] 	  		= $POSMTypeID 		: '';			isset($POSMStatusID) 	 ? $dbFields['POSMStatusID'] 	  	= $POSMStatusID 	: '';			isset($OUTLETStatusID) 	 ? $dbFields['OUTLETStatusID']   	= $OUTLETStatusID 	: $dbFields['OUTLETStatusID']   	= 0;			isset($PremiumTypeID) 	 ? $dbFields['PremiumTypeID']    	= $PremiumTypeID 	: $dbFields['PremiumTypeID']    	= 0;			isset($MaterialTypeID) 	 ? $dbFields['MaterialTypeID']   	= $MaterialTypeID 	: '';			isset($countryID) 		 ? $dbFields['countryID'] 		  	= $countryID 		: '';			isset($itemName) 	     ? $dbFields['itemName']         	= str_replace('"',"",$itemName) 		: '';			isset($Short_Description)? $dbFields['Short_Description'] 	= str_replace('"',"",$Short_Description): '';			isset($UnitPrice) 		 ? $dbFields['UnitPrice'] 		  	= $UnitPrice 		: '';			isset($USD_Price) 		 ? $dbFields['USD_Price'] 		  	= $USD_Price 		: '';			isset($MOQ) 			 ? $dbFields['MOQ'] 			  	= $MOQ 				: '';			isset($UOM) 		     ? $dbFields['UOM'] 			  	= $UOM 				: '';						isset($Fields0001) 		 ? $dbFields['Fields0001'] 	  = $Fields0001 : '';			isset($Fields0001) 		 ? $dbFields['Fields0002'] 	  = $Fields0002 : '';			isset($Fields0001) 		 ? $dbFields['Fields0003'] 	  = $Fields0003 : '';			isset($Fields0001) 		 ? $dbFields['Fields0004'] 	  = $Fields0004 : '';			isset($Fields0001) 		 ? $dbFields['Fields0005'] 	  = $Fields0005 : '';			isset($estimated_production_lead_time) ? $dbFields['estimated_production_lead_time'] = $estimated_production_lead_time : '';			isset($price_validity) 	? $dbFields['price_validity'] = $price_validity : '';						isset($publish) 	 	 		? $dbFields['publish'] 		  			= $publish 				 : '';			isset($publish_other_country) 	? $dbFields['publish_other_country']  	= $publish_other_country : '';			isset($country_of_origin) 		? $dbFields['country_of_origin'] 		= $country_of_origin 	 : '';				$dbFields['DateLastEdited']  	= date('Y-m-d');			//$dbFields['dateReleased'] 		= ($publish=='y') ? date('Y-m-d') : '0000-00-00';						//CHECK IF POSSIBLE FOR DATE RELEASED UPDATE			$sql = $this->db->query("SELECT dateReleased FROM ec_items WHERE id = $id LIMIT 0,1");			$row = $sql->row();			if($publish=='y' AND $row->dateReleased=='0000-00-00') $dbFields['dateReleased'] = date('Y-m-d');						//UPDATE ITEM CODE			$itemField['itemCode'] = $this->generate_ItemCode($id,$_SESSION['countryID'],isset($POSMTypeID) ? $POSMTypeID : 0);			$this->c3model->c3crud("update","ec_items",$itemField,$id);						//IMAGE			$config['upload_path'] = FCPATH2.'/img/items/';			$config['allowed_types'] = 'gif|jpg|png';			$this->upload->initialize($config);						if($this->upload->do_multi_upload("files")){				//Print data for all uploaded files.				//print_r($this->upload->get_multi_upload_data());								$files = $this->upload->get_multi_upload_data();				foreach($files as $f)				{					extract($f); 					//GENERATE IMAGE CODE					$new_file_name=$this->generateImgCode($id,$itemField['itemCode'],$f['file_name']);					$this->imageResize($file_name,$new_file_name,$f['file_path']);					$refdbFields['itemID'] = $id; 					$refdbFields['image']  = $new_file_name; 										$res = $this->c3model->c3crud("insert",'ecitems_images',$refdbFields,'');				}								//TAG LAST IMAGE								$this->db->query("UPDATE ecitems_images SET defaultStatus=0 WHERE itemID = $id");				$query = $this->db->query("SELECT MAX(ecitems_images.id) as lastImageID FROM ecitems_images WHERE itemID = $id LIMIT 1");				$row = $query->row();				$this->db->query("UPDATE  `ecitems_images` SET  `defaultStatus` =  '1' WHERE  `ecitems_images`.`id` = ". $row->lastImageID );			}						$this->c3model->c3crud("update",'ec_items',$dbFields,$id);									//DELETE PREVIUOS VENDORS				$this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitemVendorsRef WHERE itemID='$id'");			//VENDOR REFERENCE			if(isset($multipleVendors))			{				$refFields['itemID'] =  $id;				foreach($multipleVendors as $mV => $value)				{					$refFields['vendorID'] = $value;					$res = $this->c3model->c3crud("insert",'ecitemVendorsRef',$refFields,'');				}			}					//LOGS			if(!isset($itemName)){				$sql = "SELECT itemName FROM ec_items WHERE id = $id";				$sql = $this->db->query($sql);				$row = $sql->row();				$itemName = $row->itemName;			}			$CI->rec_logs->w($id,$itemName,'eCatalogue','eCatalogue Items','edit',$itemField['itemCode']);						$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'Item has been updated.');		}		elseif($action=='deleteOneItem')		{			$this->modules->module_checker(43,'DELETE');						$tables = array(			  array('tbl'=>'ecitemVendorsRef',					'fld'=>'itemID'));					if($this->modules->attr($tables,$id)==0)			{			//LOGS			$sql = "SELECT itemName, itemCode FROM ec_items WHERE id = $id";			$sql = $this->db->query($sql);			$sql = $sql->row();			$CI->rec_logs->w($id,$sql->itemName,'eCatalogue','eCatalogue Items','delete',$sql->itemCode);						$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'Item has been deleted.');			$this->c3model->c3crud("no-res",'','','',"DELETE FROM ec_items WHERE id='$id'");	 	    $this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitemVendorsRef  WHERE itemID='$id'");	 	    $this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitems_images 	WHERE itemID='$id'");	 	    $this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitem_views   	WHERE itemID='$id'");									}else{				$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'Item cannot be delete because it is being link to vendors.');			}					}			    		//STATUS LISTS		$sql 			  = $this->db->query("SELECT * FROM e_catalog");		$data['eCatalog'] = $sql->result_array();				if($this->modules->access_checker()==TRUE)		{				$this->load->view('innerPages',$data); 		}else{			$data['vfile']				= 'login.php';			$data['title']				= 'SMBi System Log-in | SMBi';			$data['page_title']			= 'SMBi System Log-in';			$data['meta_description']	= 'San Miguel Brewing International';			$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';			$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   			$this->load->view('login',$data); 			}	}		function generate_ItemCode($itemID,$item_Country_ID,$POSMTypeID)	{		$sql 	   = "SELECT *, id as cID FROM country";		$sql 	   = $this->db->query($sql);		$countries = $sql->result_array();				$itemCode="EC";				/*ITEM TYPE*/		if($POSMTypeID==23){			$itemCode .= "-SI-";		}elseif($POSMTypeID==29){			$itemCode .= "-PI-";		}else{			$itemCode .= "-XX-";		}				/*SERIES*/		$coding = "%04d";		if($itemID>9999)			$coding = "%0".strlen($itemID)."d";				$itemCode .= sprintf($coding, $itemID);			return $itemCode;	}			function catalogPreview($action='',$id='')	{		$this->modules->module_checker(34,'REVIEW');		    $table= "items";		$data['vfile']				= 'my_Gallery.php';	    $data['title']				= 'E - Catlog | San Miguel Brewing International';	    $data['meta_description']	= 'San Miguel Brewing International';	    $data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia'; 				//BREAD CRUMBS		$HTTP_PATH = HTTP_PATH;	 	    $data['breadCrumbs']	   = '<a href='.$HTTP_PATH.'eCatalog/catalog> e-Catalog </a>';				//TOTAL NUMBER OF ROWS		$data['active_page']=1;		$sql = $this->db->query("SELECT *,								OUTLET_Status.statusName as OutletStatusName, 								POSM_Status.statusName as POSMStatusName,								items.id as itemID 								FROM items 								LEFT JOIN POSM_Type ON items.POSMTypeID = POSM_Type.id 								LEFT JOIN POSM_Status ON items.POSMStatusID = POSM_Status.id 								LEFT JOIN OUTLET_Status ON items.OUTLETStatusID = OUTLET_Status.id								LEFT JOIN premiumItemType ON items.PremiumTypeID = premiumItemType.id 								LEFT JOIN MATERIAL_Type ON items.MaterialTypeID = MATERIAL_Type.id 								LEFT JOIN country ON items.countryID = country.id 								LEFT JOIN brands  ON items.brandID = brands.id								WHERE items.id								IN (SELECT itemID FROM e_CatalogItemsRef WHERE eCatalogID=$id) ");		$sql = $sql->result_array();		$total_rec = count($sql);		$pagenum = 1;		$data['page_rows'] = 16; 		$data['last'] = ceil($total_rec/$data['page_rows']);				$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];				if($action=="page")		{			$pagenum = $id;			$data['active_page'] = $id; 			$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];		}				//STATUS LISTS	    $sqlSTr="SELECT *,				OUTLET_Status.statusName as OutletStatusName, 				POSM_Status.statusName as POSMStatusName,				items.id as itemID 				FROM items 				LEFT JOIN POSM_Type ON items.POSMTypeID = POSM_Type.id 				LEFT JOIN POSM_Status ON items.POSMStatusID = POSM_Status.id 				LEFT JOIN OUTLET_Status ON items.OUTLETStatusID = OUTLET_Status.id				LEFT JOIN premiumItemType ON items.PremiumTypeID = premiumItemType.id 				LEFT JOIN MATERIAL_Type ON items.MaterialTypeID = MATERIAL_Type.id 				LEFT JOIN country ON items.countryID = country.id 				LEFT JOIN brands  ON items.brandID = brands.id				WHERE items.id				IN (SELECT itemID FROM e_CatalogItemsRef WHERE eCatalogID=$id) $max";		$sql = $this->db->query($sqlSTr);		$data['items'] = $sql->result_array();				if($this->modules->access_checker()==TRUE)		{				$this->load->view('innerPages',$data); 		}else{			$data['vfile']				= 'login.php';			$data['title']				= 'SMBi System Log-in | SMBi';			$data['page_title']			= 'SMBi System Log-in';			$data['meta_description']	= 'San Miguel Brewing International';			$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';			$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   			$this->load->view('login',$data); 			}	  }		function pushItem($itemID)	{		$_SESSION['eCatalog_Items'] .= $itemID."|";						$itemDB =  "SELECT itemName, items.id AS itemID, 					(SELECT image FROM items_images WHERE items_images.itemID =  items.id LIMIT 1) AS image					FROM items 					WHERE items.id = $itemID LIMIT 1";				$sql = $this->db->query($itemDB);		$items = $sql->result_array();				foreach($items as $d){			extract($d);						$item_img = isset($image) ? $image : 'blank.png';			$img_path = HTTP_PATH."img/items/$item_img";			$itemPreviewLink = HTTP_PATH."itemDatabase/items/preview/$itemID"; 						echo "<div style='width:160px;height:150px;margin:10px;' class='fl'>					<div style='border: 1px solid #ccc;text-align:center;padding:5px;height:100px;'>						<img src='$img_path' class='itemIcon'>					</div>										<p style='font-size:13px;text-align:center;border: 1px solid #ccc;padding-bottom:3px;'> 						<b><a href='$itemPreviewLink' target='_blank' class='itemLink'> $itemName </a></b> <br/>												<span onclick='removeItem($itemID)' class='removeIcon'> Remove  </span> 					</p>				</div>";		}	}  		function deleteImg($id,$itemID)	{	  $this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitems_images WHERE id='$id'");	}		function removeItem($itemID)	{				//REMOVE ITEM FROM DATABASE		$items = explode('|',$_SESSION['eCatalog_Items']);				$j=0;		$newSession = '';		for($i=0;$i<(count($items)-1);$i++)		{			if($items[$i] != $itemID)			{				$newSession .= $items[$i]."|";			}		}				$_SESSION['eCatalog_Items'] = '';		$_SESSION['eCatalog_Items'] = $newSession;						//EXPLODE ITEM				$items2 = explode('|',$_SESSION['eCatalog_Items']);				for($k=0;$k<(count($items2));$k++){					if($items2[$k]!=NULL){				//ITEMS PAGINATION								$itemDB =  "SELECT  itemName, items.id AS itemID, 							(SELECT image FROM items_images WHERE items_images.itemID =  items.id LIMIT 1) AS image							FROM items							WHERE items.id = ".$items2[$k] ." LIMIT 1";								$sql = $this->db->query($itemDB);				$items = $sql->result_array();								foreach($items as $d){					extract($d);										$item_img = isset($image) ? $image : 'blank.png';					$img_path = HTTP_PATH."img/items/$item_img";					$itemPreviewLink = HTTP_PATH."itemDatabase/items/preview/$itemID"; 										echo "<div style='width:160px;height:150px;margin:10px;' class='fl'>							<div style='border: 1px solid #ccc;text-align:center;padding:5px;height:100px;'>								<img src='$img_path' class='itemIcon'>							</div>														<p style='font-size:13px;text-align:center;border: 1px solid #ccc;padding-bottom:3px;'> 								<b><a href='$itemPreviewLink' target='_blank' class='itemLink'> $itemName </a></b> <br/>																<span onclick='removeItem($itemID)' class='removeIcon'> Remove  </span> 							</p>						</div>";				}			}		}			}		function itemOnSession($itemID)	{		//REMOVE ITEM FROM DATABASE		$items = explode('|',$_SESSION['eCatalog_Items']);				$j=0;		$exist = '';		for($i=0;$i<(count($items)-1);$i++)		{			if($items[$i] == $itemID)				$exist = 'exist';		}				echo $exist;	}		private function imageResize($filename,$new_file_name,$path)	{	    copy($path.$filename,getcwd() .'/img/big/'. $new_file_name);		$config['image_library'] = 'gd2';		$config['source_image']	=getcwd() .'/img/big/'. $new_file_name;		$config['maintain_ratio'] = TRUE;		$config['quality'] = '100%';		$config['width']	 =800;		$config['height']	 =600;		$this->image_lib->initialize($config);   		$this->image_lib->resize();				copy($path.$filename,getcwd() .'/img/small/'. $new_file_name);	    $config['source_image']	=getcwd() .'/img/small/'. $new_file_name;		$config['width']	 =400;		$config['height']	 =300;		$this->image_lib->initialize($config);   		$this->image_lib->resize();				copy($path.$filename,getcwd() .'/img/galleryImg/'. $new_file_name);	    $config['source_image']	=getcwd() .'/img/galleryImg/'. $new_file_name;		$config['create_thumb'] = TRUE;		$config['height']	 =165;		$config['maintain_ratio'] = TRUE;		$this->image_lib->initialize($config);   		$this->image_lib->resize();				copy($path.$filename,getcwd() .'/img/thumb/'. $new_file_name);		$config['source_image']	=getcwd() .'/img/thumb/'. $new_file_name;		$config['width']	 =45;		$config['height']	 =45;		$config['maintain_ratio'] = TRUE;		$this->image_lib->initialize($config);   		$this->image_lib->resize();	  }		function showItems($cID)	{		$EDIT 	=  $this->modules->crud_checker(43,'EDIT');	    $DELETE =  $this->modules->crud_checker(43,'DELETE');	    $REVIEW =  $this->modules->crud_checker(43,'REVIEW');				$VENDORS_EDIT =  $this->modules->crud_checker(44,'EDIT');				$sqlSTr =  "SELECT ec_items.id AS iID, itemName, Short_Description, publish, itemCode,					(SELECT image FROM  ecitems_images WHERE defaultStatus = 1 AND itemID = ec_items.id LIMIT 0,1) AS iImg					FROM ec_items 					WHERE ecID='$cID' ORDER BY ec_items.id DESC";							$sql 		= $this->db->query($sqlSTr);		$items		= $sql->result_array();									if($items){		echo "<table cellpadding='0' cellspacing='0' border=1 style='width:100%;margin: 0px auto;font-size:12px;' class='iLike_Result_Table'>			 <tr style='border-radius: 6px;'>				<td style='width:10px;text-align:center;background:rgb(175,  168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>   <b>No 		   			</b></td> 				<td style='width:30px;text-align:center;background:rgb(175,  168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>   <b>Image  	   			</b></td> 				<td style='width:40px;text-align:center;background:rgb(175, 168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>   <b>Item Code    			</b></td> 				<td style='width:130px;text-align:center;background:rgb(175, 168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>   <b>Item Name    			</b></td> 				<td style='width:200px;text-align:center;background:rgb(175,  168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>  <b>Short Description  	</b></td> 				<td style='width:80px;text-align:center;background:rgb(175,  168, 168);color:black;font-weight:bold;padding: 2px 2px 2px 5px;'>   <b>Action  				</b></td> 			</tr>";		 			$x = 0;			$total = 0;			//print_r($items);			foreach($items as $i) { 			extract($i);			$c = (($x++)%2) == 0 ? "class='alter'" :  ""; 			$gray = '';			if($publish != 'y'){				$gray =  "style='background:#AFAFAF'";				$c = '';			}		 			echo	"<tr>					  <td $c  style='text-align:center;padding: 0px 2px 0px 0px;'>	$x 											  </td>					  <td $c  style='text-align:center;padding: 0px 2px 0px 10px;'>							<img src='".HTTP_PATH."img/galleryImg/$iImg' style='height:30px'>";						if($gray!='')							echo "<label style='color:red;font-size:10px;margin: 0;'> *Draft </label>";			echo	 "</td>					  <td $c  style='text-align:left;padding: 0px 2px 0px 10px;'>	$itemCode  									  </td>					  <td $c  style='text-align:left;padding: 0px 2px 0px 10px;'>	$itemName  									  </td>					  <td $c  style='text-align:left;padding: 0px 2px 0px 10px;'>	$Short_Description  						  </td>					  <td $c  style='text-align:center;padding: 0px 2px 0px 10px;'>	";						if($REVIEW)							echo "<a href='".HTTP_PATH."gallery/itemInfoECatalog/$cID/$iID/eCITEMS' target='eC_ItemsTab'>View</a> |";						if($EDIT OR $VENDORS_EDIT)							echo "<a href='".HTTP_PATH."eCatalog/items/edit/$iID' target='eC_ItemsTab'>Edit</a> |";						if($DELETE)							echo "<a style='cursor:pointer' onclick='deleteOneItem($iID)'>Delete</a> ";			echo	"</tr>";			}		echo"</table>";		}else{			echo "<label> Sorry, no items found. </label>";		}	}			/*ITEMS DELETE IMAGE*/	function deleteOneImg($id,$itemID)	{			//CHECK IF AN ITE IS DEFAULT		$query = $this->db->query("SELECT defaultStatus FROM ecitems_images WHERE id = '$id' LIMIT 1");		$row = $query->row();				if($row->defaultStatus==1){						//DELETE CURRENT			$this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitems_images WHERE id='$id'");						//TAG LAST IMAGE			$query = $this->db->query("SELECT MAX(ecitems_images.id) as lastImageID FROM ecitems_images WHERE itemID = $itemID LIMIT 1");			$row = $query->row();			if($row!=NULL)				$this->db->query("UPDATE  `ecitems_images` SET  `defaultStatus` =  '1' WHERE  `ecitems_images`.`id` = ". $row->lastImageID );		}else{			$this->c3model->c3crud("no-res",'','','',"DELETE FROM ecitems_images WHERE id='$id'");		}				echo true;				}	/*ITEMS DELETE IMAGE*/		/*SET DEFAULT IMAGE*/	function setDefaultImg($id,$itemID)	{				//UNSET ALL ITEM IMAGES TO 0		$this->db->query("UPDATE ecitems_images SET defaultStatus=0 WHERE itemID = $itemID");		$this->db->query("UPDATE  `ecitems_images` SET  `defaultStatus` =  '1' WHERE  `ecitems_images`.`id` = ". $id );				echo true;	}	/*SET DEFAULT IMAGE*/		/*VENDORS*/	function vendors($action='',$id='')	{		$CI =& get_instance();		$CI->load->library('rec_logs');		$this->modules->module_checker(44,'REVIEW');				$table= "ec_vendors";		$data['vfile']				= 'ec_vendors.php';	    $data['title']				= 'eCatalogue Vendors | San Miguel Brewing International';	    $data['meta_description']	= 'San Miguel Brewing International';	    $data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';				//CRUD		$data['ADD'] 	=  $this->modules->crud_checker(44,'ADD');		$data['EDIT'] 	=  $this->modules->crud_checker(44,'EDIT');		$data['DELETE'] =  $this->modules->crud_checker(44,'DELETE');				//USER MANUAL		$data['USER_MANUAL'] = $this->modules->user_manual(8);				//BREAD CRUMBS		$HTTP_PATH = HTTP_PATH;	    $data['breadCrumbs']		= '<a href='.$HTTP_PATH.'itemDatabase> Item Database </a>';	    $data['breadCrumbs']	   .= '<li><img src="'.$HTTP_PATH.'img/arrow.png" width="3" height="5"></li>';	    $data['breadCrumbs']	   .= '<a href='.$HTTP_PATH.'eCatalog/vendors> eCatalogue Vendors </a>';	    				//CSRF		$data['csrf'] = "<input type='hidden' name='".$this->security->get_csrf_token_name()."' value='".$this->security->get_csrf_hash()."'>"; 				//PAGINATION		//PAGINATION		//TOTAL NUMBER OF ROWS		$data['active_page']=1;		$sql = $this->db->query("SELECT id FROM $table");		$sql = $sql->result_array();		$total_rec = count($sql);		$pagenum = 1;		$data['page_rows'] = 15; 		$data['last'] = ceil($total_rec/$data['page_rows']);				$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];				extract($_POST);	    if($action=="insert")		{			$this->modules->module_checker(44,'ADD');						//INSERT FIELD			$dbFields['company_name'] 		= $company_name; 			$dbFields['fname'] 		  		= $fname; 			$dbFields['mname'] 		  		= $mname; 			$dbFields['lname'] 		  		= $lname; 			$dbFields['email'] 		  		= $email; 			$dbFields['telephone']    		= $telephone;  			$dbFields['billing_address'] 	= $billing_address; 			$dbFields['postal_code']  		= $postal_code; 			$dbFields['city_state']   		= $city_state;			$dbFields['dateAdded']      	= date('Y-m-d');						//MSG			$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'Vendor has been save.');			$res = $this->c3model->c3crud("insert",$table,$dbFields,'');						//LOGS			$sql		= "select max(id) as max_id FROM $table";			$lastID 	= $this->c3model->c3crud("select",'','','',$sql);			$maxID 		= $lastID[0]['max_id'];			$CI->rec_logs->w($maxID,$company_name,'eCatalogue','eCatalogue Vendors',isset($duplicate) ? 'duplicate' : 'add');		}		elseif($action=="deleteOneItem")		{			$this->modules->module_checker(44,'DELETE');						$tables = array(			  array('tbl'=>'ecitemVendorsRef',					'fld'=>'vendorID'));					if($this->modules->attr($tables,$id)==0)			{			//LOGS			$sql = "SELECT company_name FROM $table WHERE id = $id";			$sql = $this->db->query($sql);			$sql = $sql->row();					$CI->rec_logs->w($id,$sql->company_name,'eCatalogue','eCatalogue Vendors','delete');									$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'Vendor has been deleted.');			$this->c3model->c3crud('delete',$table,'',$id,'');						}else{				$data['msg'] = array('msg_type'=>'alert-warning','msg_desc'=>'Vendor cannot be delete because it is being used by eCatalogue items.');			}		}		elseif($action=="edit")		{			$this->modules->module_checker(44,'EDIT');			$data['id'] = $id;			$data['vfile']	= 'ec_vendorFORM.php';		}		elseif($action=="duplicate")		{			$this->modules->module_checker(44,'ADD');			$data['id'] = $id;			$data['duplicateID'] = $id;			$data['vfile']	= 'ec_vendorFORM.php';		}		elseif($action=="update")		{			$this->modules->module_checker(44,'EDIT');			$dbFields['company_name'] 		= $company_name; 			$dbFields['fname'] 		  		= $fname; 			$dbFields['mname'] 		  		= $mname; 			$dbFields['lname'] 		  		= $lname; 			$dbFields['email'] 		  		= $email; 			$dbFields['telephone']    		= $telephone; 			$dbFields['billing_address'] 	= $billing_address; 			$dbFields['postal_code']  		= $postal_code; 			$dbFields['city_state']   		= $city_state;			$dbFields['dateLastEdited']     = date('Y-m-d');						$data['msg'] = array('msg_type'=>'alert-success','msg_desc'=>'Vendor has been updated.');			$this->c3model->c3crud("update",$table,$dbFields,$id);						$CI->rec_logs->w($id,$company_name,'eCatalogue','eCatalogue Vendors','edit');		}		elseif($action=="page")		{			$this->modules->module_checker(44,'REVIEW');			$pagenum = $id;			$data['active_page'] = $id; 			$max = 'limit ' .($pagenum - 1) * $data['page_rows'] .',' .$data['page_rows'];		}		elseif($action=="add")		{			$this->modules->module_checker(44,'ADD');			$data['vfile']	= 'ec_vendorFORM.php';		}				$sql 			= $this->db->query("SELECT * FROM $table ORDER by id DESC $max");		$data['data'] = $sql->result_array();			   if($this->modules->access_checker()==TRUE)	   {			$this->load->view('innerPages',$data); 	   }else{		$data['vfile']				= 'login.php';		$data['title']				= 'SMBi System Log-in | SMBi';		$data['page_title']			= 'SMBi System Log-in';		$data['meta_description']	= 'San Miguel Brewing International';		$data['meta_keyword']		= 'Food,beverage,packaging,Corporation, San Miguel,company , Philippines ,Southeast Asia';		$data['msg'] 				= array('msg_type'=>'alert-warning','msg_desc'=>'Warning: Please login.');   		$this->load->view('login',$data); 		   }	}	} ?>